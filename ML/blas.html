<!DOCTYPE html>
<html>
<title>BLAS</title>

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <link href="https://fonts.googleapis.com/css?family=Roboto:400,500" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">

  <link rel="stylesheet" href="/css/my.css">
  <link rel="stylesheet" type="text/css" href="/css/shCore.css" />
  <link rel="stylesheet" type="text/css" href="/css/shThemeDefault.css" />

  <script type="text/javascript" src="/js/shCore.js"></script>
  <script type="text/javascript" src="/js/shBrushCpp.js"></script>

<style>
.formula {
    font-family: 'Roboto', sans-serif;
    font-weight: 500;
    font-size:22pt;
    color: #009688;
}
</style>


</head>

<body>

<!-- Title -->
<div>
<ul class="my-bar">
  <li class="my-left"><span class="my-bar-item">Data Visualization</span></li>
  <li class="my-right"><a href="/" class="my-bar-item"><i class="fa fa-home"/></i></a></li>
</ul>
</div>


<!--Content -->
<div class="my-content">

<h1>Matrix Multiplication with BLAS</h1>

<p>
BLAS (Basic Linear Algebra Subprograms) is a library of basic vector and matrix operations.
Originally written in Fortran, it has bindings for C and other languages.
There are multiple implementations of this library, such as OpenBLAS, 
Intel Math Kernel Library (MKL), cuBLAS from Nvidia, just to name a few.
</p>

<p>
Let's explore "general matrix multiplication" (gemm) API.
</p>


<h2>GEMM</h2>

<p>
The "gemm" operation is defined as
</p>

<p class="formula">
C(m,n) = alpha * A(m,k) * B(k,n) + beta * C(m,n) 
</p>

<p>
Where
</p>

<ul>
  <li>A, B, and C are matrices.</li>
  <li>Alpha and beta are scaling factors.</li>
  <li>M - number of rows in matrices A and C.</li>
  <li>N - number of columns in matrices B and C.</li>
  <li>K - number of columns in matrix A or number of rows in matrix B.</li>
</ul>

<p>
C API, also called "CBLAS", defines this operation as follows.
</p>

<script type="syntaxhighlighter" class="brush: cpp"><![CDATA[
void cblas_sgemm(
    CBLAS_LAYOUT layout, 
    CBLAS_TRANSPOSE TransA, 
    CBLAS_TRANSPOSE TransB, 
    const int M, const int N, const int K, 
    const float alpha, 
    const float *A, const int lda, 
    const float *B, const int ldb,
    const float beta, 
    float *C, const int ldc
);
]]></script>

<p>
Note that there are few versions of this function, such as "sgemm" (single-precision),
"dgemm" (double-precision), "cgemm" (single-precision complex), and
"zgemm" (double-precision complex). 
</p>


<h2>Memory Layout</h2>
<p>
As you can see from <i>cblas_sgemm()</i> method signature, matrices are passed 
as float pointers. A pointer is just an address of a linear memory buffer.
There are two methods for storing multi dimensional data in a linear storage -
row-major or column-major.
</p>

<img src="img/blas-layout.png" width="50%">

<p>
In a column-major order, the consecutive elements of a column reside next to 
each other, whereas in a row-major order, the consecutive elements of a row reside next to each other.
</p>

<p>
First parameter in <i>cblas_sgemm()</i> specifies row-major or column-major order.
Not all BLAS implementations let you choose memory layout for matrices. 
Original Fortran implementation or cuBLAS from Nvidia are column-major only.
</p>

<h2>CBLAS Example</h2>

<img src="img/blas-mult1.png" width="70%">


</div>

<!-- Do syntax highlighting -->
<script>
SyntaxHighlighter.defaults['toolbar'] = false;
SyntaxHighlighter.all()
</script>

</body>

</html>

